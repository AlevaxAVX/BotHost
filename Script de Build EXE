import PyInstaller.__main__
import os
import shutil
import sys

# Nom de ton application
APP_NAME = "BotHost"

def build():
    # 1. Nettoyage des dossiers temporaires pr√©c√©dents
    for folder in ['dist', 'build']:
        if os.path.exists(folder):
            shutil.rmtree(folder)

    print(f"üî® Compilation de {APP_NAME} en cours...")

    # 2. Configuration de PyInstaller
    params = [
        'main.py',                      # Fichier d'entr√©e principal
        f'--name={APP_NAME}',           # Nom de l'ex√©cutable
        '--onefile',                    # Tout mettre dans un seul .exe
        '--windowed',                   # Ne pas ouvrir de terminal noir en arri√®re-plan
        
        # Ajout des dossiers de ressources (Source;Destination)
        '--add-data=web;web',           
        '--add-data=core;core',
        '--add-data=api;api',
        
        # Nettoyage automatique des fichiers temporaires apr√®s build
        '--clean',
    ]

    # Ajout d'une ic√¥ne si elle existe
    icon_path = os.path.join('web', 'favicon.ico')
    if os.path.exists(icon_path):
        params.append(f'--icon={icon_path}')

    # 3. Lancement du build
    try:
        PyInstaller.__main__.run(params)
        print(f"\n‚úÖ Termin√© ! L'ex√©cutable se trouve ici : dist/{APP_NAME}.exe")
    except Exception as e:
        print(f"\n‚ùå Erreur lors de la compilation : {e}")

if __name__ == "__main__":
    build()
